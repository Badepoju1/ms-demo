<!--
 Copyright 2020 Google LLC

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

{{ define "cart" }} {{ template "header" . }}
<div {{ with $.platform_css }} class="{{.}}" {{ end }}>
    <span class="platform-flag">
        EMMA STORE
    </span>
</div>
<main role="main" class="cart">
    <div class="cart-bg">
        <div class="container py-3 px-lg-5 py-lg-5">
            {{ if eq (len $.items) 0 }}
            <h3>Your shopping cart is empty!</h3>
            <p>Items you add to your shopping cart will appear here.</p>
            <a class="btn btn-info" href="/" role="button">Browse Products &rarr; </a> {{ else }}

            <div class="row mb-3 py-2">
                <div class="col">
                    <h3>{{ $.cart_size }} item {{- if gt ($.cart_size) 1}}s{{end}} in your cart</h3>
                </div>
                <div class="col text-right">
                    <form method="POST" action="/cart/empty">
                        <button class="btn btn-secondary empty-btn" type="submit">Empty cart</button>
                        <a class="btn btn-info" href="/" role="button">Keep browsing</a>
                    </form>

                </div>
            </div>

            <div id="prod_list">
                {{ range $.items }}
                <div class="product-item">
                    <div class="row pt-2 mb-2">
                        <div class="col text-right image">
                            <a href="/product/{{.Item.Id}}">
                                <img class="img-fluid" alt="" src="{{.Item.Picture}}" />
                            </a>
                        </div>
                        <div class="col text-left text">
                            <h4>{{ .Item.Name }}</h4>
                            <p><small class="text-muted">SKU: #{{ .Item.Id }}</small></p>
                            <div class="details">
                                Quantity: {{ .Quantity }}<br />
                                <strong>
                                    {{ renderMoney .Price }}
                                </strong>
                            </div>
                        </div>
                    </div>
                </div>
                {{ end }}

                <div class="row pt-2 my-3">
                    <div class="col text-center order-summary">
                        <p class="text-muted my-0">Shipping Cost: <strong>{{ renderMoney .shipping_cost }}</strong></p>
                        Total Cost: <strong>{{ renderMoney .total_cost }}</strong>
                    </div>

                    <div class="form-row center-contents last-row">
                        <button id="place-order" onclick="storeProdAndPay()" class="btn btn-info" type="" disabled>Proceed to pay</button>
                    </div>
                </div>
                {{ end }}
            </div>



            <!-- end if $.items -->

        </div>
        {{ if $.recommendations}} {{ template "recommendations" $.recommendations }} {{ end }}
    </div>


    <!-- <!DOCTYPE html>
    <html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Image Link</title>
    </head>

    <body>
        <h1>Image Link</h1>
        <a href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIA..." target="_blank">View Image</a>
    </body>

    </html> -->

    <!-- <script src="https://js.pusher.com/7.2/pusher.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js" integrity="sha256-/H4YS+7aYb9kJ5OKhFYPUjSJdrtV6AeyJOtTkw6X72o=" crossorigin="anonymous"></script>

    <script>
        function storeProdAndPay() {
            prod_list = document.getElementById("prod_list").innerHTML;
            prod_list.replace('/static', '../static');
            data = CryptoJS.AES.encrypt(prod_list, "PRODLIST");

            // redirect to payment page
            url = "https://emma-store.netlify.app/order/payment.html?data=" + data;
            window.location.href = url;
        }
    </script>
    </script>


    <script>
    </script>
</main>
{{ template "footer" . }} {{ end }}